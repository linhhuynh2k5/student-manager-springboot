<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω sinh vi√™n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

<h2 class="text-center mb-4">üéì QU·∫¢N L√ù SINH VI√äN</h2>

<!-- FORM -->
<div class="card p-3 mb-3">
    <input type="hidden" id="id">
    <div class="row g-2">
        <div class="col">
            <input id="name" class="form-control" placeholder="H·ªç t√™n">
        </div>
        <div class="col">
            <input id="age" type="number" class="form-control" placeholder="Tu·ªïi">
        </div>
        <div class="col">
            <input id="email" class="form-control" placeholder="Email">
        </div>
        <div class="col">
            <button class="btn btn-success w-100" onclick="save()">L∆∞u</button>
        </div>
    </div>
</div>

<!-- SEARCH -->
<div class="input-group mb-3">
    <input id="search" class="form-control" placeholder="T√¨m theo t√™n">
    <button class="btn btn-primary" onclick="search()">T√¨m</button>
</div>

<!-- TABLE -->
<table class="table table-bordered table-hover">
    <thead class="table-dark">
    <tr>
        <th>ID</th><th>T√™n</th><th>Tu·ªïi</th><th>Email</th><th>H√†nh ƒë·ªông</th>
    </tr>
    </thead>
    <tbody id="data"></tbody>
</table>

<script>
const api = "/api/students";

function load() {
    fetch(api).then(r=>r.json()).then(show);
}

function show(list) {
    let html = "";
    list.forEach(s => {
        html += `
        <tr>
            <td>${s.id}</td>
            <td>${s.name}</td>
            <td>${s.age}</td>
            <td>${s.email}</td>
            <td>
                <button class="btn btn-warning btn-sm" onclick='edit(${JSON.stringify(s)})'>S·ª≠a</button>
                <button class="btn btn-danger btn-sm" onclick="del(${s.id})">X√≥a</button>
            </td>
        </tr>`;
    });
    document.getElementById("data").innerHTML = html;
}

function save() {
    let id = document.getElementById("id").value;
    let student = {
        name: name.value,
        age: age.value,
        email: email.value
    };
    let url = id ? `${api}/update/${id}` : api;
    fetch(url,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(student)
    }).then(()=>{ clear(); load(); });
}

function del(id) {
    fetch(`${api}/delete/${id}`,{method:"POST"}).then(load);
}

function edit(s) {
    id.value = s.id;
    name.value = s.name;
    age.value = s.age;
    email.value = s.email;
}

function search() {
    fetch(`${api}/search?name=${search.value}`).then(r=>r.json()).then(show);
}

function clear(){
    id.value=""; name.value=""; age.value=""; email.value="";
}

load();
</script>

</body>
</html>
